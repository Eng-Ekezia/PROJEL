{
  "project": {
    "version": "0.8.0",
    "purpose": "Aplicação web didática para apoio ao dimensionamento de circuitos elétricos conforme ABNT NBR 5410.",
    "current_status": "Fase 08 em andamento (Refatoração e Circuitos)",
    "last_update": "2024-02-02",
    "target_audience": [
      "engenharia civil",
      "engenharia de energia",
      "estudantes de eletrotecnica"
    ],
    "constraints": {
      "cost": "zero (forever free)",
      "license": "open-source",
      "deployment": "stateless backend (free-tier friendly)",
      "privacy": "local-first (sem banco de dados no servidor)"
    },
    "core_principles": [
      "engenharia antes de calculo",
      "contexto antes de circuito",
      "norma como regra explicita e auditavel",
      "usuario descreve a realidade, sistema traduz para a norma",
      "rastreabilidade total das decisoes"
    ],
    "history": [
      {
        "date": "2026-01-XX",
        "event": "Início do desenvolvimento (Fases 01-06)",
        "details": "Configuração do ambiente, Backend FastAPI, Estrutura inicial."
      },
      {
        "date": "2026-02-01",
        "event": "Migração de UI e Modelagem Core (Fase 07)",
        "details": "Substituição total do Material UI pelo shadcn/ui + Tailwind CSS v3. Implementação estrita das entidades Zona, Local e Carga. Criação dos Wizards NBR 5410."
      },
      {
        "date": "2026-02-02",
        "event": "Problemas Enfrentados e Soluções (Documentation)",
        "details": [
          "PROBLEMA: Incompatibilidade entre Vite e Tailwind v4. SOLUÇÃO: Downgrade para Tailwind v3.4 e configuração manual do PostCSS.",
          "PROBLEMA: Arquivo ProjectDetails.tsx tornou-se um 'God Object' (monolítico). SOLUÇÃO: Planejamento de refatoração modular para a Fase 08.",
          "PROBLEMA: Definição de Zona incompleta (faltava Categoria C - Construção). SOLUÇÃO: Atualização dos Types e UI para conformidade total com NBR 5410.",
          "PROBLEMA: Visual quebrado por CSS residual do Vite. SOLUÇÃO: Limpeza do App.css e reset global no index.css."
        ]
      }
    ]
  },
  "technology_stack": {
    "frontend": {
      "framework": "React",
      "language": "TypeScript (Strict Mode / VerbatimModuleSyntax)",
      "bundler": "Vite (Composite Mode)",
      "ui_library": "Change from Material UI (MUI) v6 to shadcn/ui + Tailwind CSS v3.4 in phase 07",
      "state_management": "Zustand + Persist Middleware (LocalStorage)"
    },
    "backend": {
      "framework": "FastAPI",
      "language": "Python",
      "python_version": ">=3.11",
      "architecture": "Stateless (Calculation Engine)"
    },
    "database": {
      "type": "None (Server-side) / LocalStorage (Client-side)",
      "usage": [
        "persistencia no navegador do usuario via Zustand",
        "exportacao/importacao via JSON",
        "total privacidade de dados"
      ]
    },
    "deployment": {
      "frontend": "Vercel",
      "backend": "Render (Web Service)"
    }
  },
  "roadmap": [
    {
      "phase": "00",
      "name": "Congelamento conceitual e Arquitetural",
      "objective": "Definir limites do sistema e estrategia de dados",
      "outputs": [
        "decisao por arquitetura stateless",
        "modelo de dados JSON portavel",
        "alinhamento com NBR 5410"
      ],
      "status": "concluido"
    },
    {
      "phase": "01",
      "name": "Preparacao do ambiente",
      "objective": "Criar ambiente reprodutivel",
      "steps": [
        "Python 3.11+",
        "Node.js (LTS)",
        "Configuracao de VENV",
        "Instalacao de dependencias (FastAPI, Pydantic, Uvicorn)"
      ],
      "deliverable": "Ambiente local configurado",
      "status": "concluido"
    },
    {
      "phase": "02",
      "name": "Organizacao do Monorepo",
      "objective": "Estrutura de codigo limpa e separada por responsabilidade",
      "details": {
        "repository": {
          "type": "monorepo",
          "structure": [
            "/frontend",
            "/backend",
            "/domain_core",
            "/docs"
          ]
        },
        "git_strategy": {
          "gitignore": "unificado (python + node)",
          "branching": "main based"
        }
      },
      "deliverable": "Repositorio Git inicializado com estrutura de pastas",
      "status": "concluido"
    },
    {
      "phase": "03",
      "name": "Configuracao do Backend Stateless",
      "objective": "Criar API de processamento puro (sem persistencia)",
      "principles": [
        "API nao salva estado",
        "API recebe Projeto -> Devolve Resultado",
        "Validacao forte na entrada (Pydantic)"
      ],
      "initial_endpoints": [
        "/health",
        "/version",
        "/v1/calcular/dimensionamento",
        "/v1/calcular/demanda"
      ],
      "deliverable": "API rodando com Swagger/OpenAPI",
      "status": "concluido"
    },
    {
      "phase": "04",
      "name": "Configuracao do Frontend & Estado Global",
      "objective": "Criar base de UX e gerenciador de estado persistente",
      "principles": [
        "Linguagem humana",
        "Feedback imediato",
        "Persistencia automatica no navegador"
      ],
      "milestones": [
        "Integracao do Zustand para gerenciamento de estado global",
        "Configuracao rigorosa do TypeScript (Composite Mode / noEmit)",
        "Resolucao de conflitos de importacao de tipos (VerbatimModuleSyntax)",
        "Dashboard de Projetos funcional com CRUD basico"
      ],
      "deliverable": "Frontend React inicializado com Store Zustand persistente",
      "status": "concluido"
    },
    {
      "phase": "05",
      "name": "Modelagem do dominio eletrico (Core)",
      "objective": "Traduzir NBR 5410 para classes Python ricas e interfaces TS",
      "schemas": {
        "ProjetoEletrico": "Concluido",
        "ZonaDeInfluencia": "Concluido (com Presets)",
        "Local": "Concluido (Validacao Geometrica)",
        "Circuito": "Pendente"
      },
      "rules": [
        "Validacao de Potencia vs Corrente (Mutuamente Exclusivos)",
        "Heranca de influencias da zona para os circuitos"
      ],
      "deliverable": "Modulo domain_core auditado e Interfaces TS sincronizadas",
      "status": "concluido"
    },
    {
      "phase": "06",
      "name": "UX de Contexto e Presets Normativos",
      "objective": "Facilitar a entrada de dados com modelos da NBR 5410 (Zonas e Locais)",
      "features": [
        "Presets de Zonas (Residencial, Comercial)",
        "Wizard de Criacao de Zonas e Locais",
        "Edicao e Exclusao de Entidades",
        "Validacao visual de status (Preset vs Custom)"
      ],
      "deliverable": "Interface de Zonas e Locais funcional e auditavel",
      "status": "concluido"
    },
    {
      "phase": "07",
      "name": "Modelagem de Cargas e Migração UI",
      "objective": "Implementar hierarquia Zona > Local > Carga e modernizar interface",
      "features": [
        "Migração completa para shadcn/ui + TailwindCSS",
        "CRUD de Zonas com classificação NBR 5410 (Ambiente, Pessoas, Construção)",
        "CRUD de Locais com Perfil Normativo (Cozinha, Banheiro, Padrão)",
        "CRUD de Cargas com distinção de origem (Usuário vs Norma)",
        "Wizard de Sugestão Automática de Cargas (NBR 5410 Cap. 9)"
      ],
      "deliverable": "Interface moderna e dados estruturados prontos para agrupamento",
      "status": "concluido"
    },
    {
      "phase": "08",
      "name": "Refatoração Modular e Gestão de Circuitos",
      "objective": "Modularizar a UI, implementar CRUD de Projetos e Gestão de Circuitos com Drag-and-Drop",
      "branch_suggested": "feat/phase-08-circuits-refactor",
      "features": [
        "8.1 [FEITO] REFATORAÇÃO: Quebrar ProjectDetails.tsx em componentes isolados (ZoneTab, LocalTab, CargaTab, CircuitosTab)",
        "8.2 [FEITO] PROJETO: Implementar Edição e Deleção de Projetos com Dialogs Shadcn e proteção de clique (stopPropagation)",
        "8.3 [ADIADO] ZONAS: Wizard Assistido (Movido para Fase 11 - UX Polish)",
        "8.4 [ADIADO] CARGAS: Adição em Lote (Movido para Fase 11 - UX Polish)",
        "8.5 [FEITO] CIRCUITOS: Entidade 'Circuito' no Backend (Single Source of Truth) com Enums da NBR 5410",
        "8.6 [FEITO] CIRCUITOS: UI de Drag-and-Drop (@dnd-kit) para agrupar cargas, com Soft Validation (Avisos normativos)"
      ],
      "deliverable": "Módulo de circuitos funcional, código desacoplado e arquitetura pronta para escalabilidade.",
      "status": "concluido"
    },
    {
      "phase": "09",
      "name": "Reestruturação de Navegação (Sidebar Layout)",
      "objective": "Migrar de Abas para Navegação Lateral (Nested Routes) para suportar tabelas complexas de dimensionamento",
      "branch_suggested": "feat/phase-09-sidebar-navigation",
      "features": [
        "9.1 ROTAS: Configurar React Router com Nested Routes",
        "9.2 LAYOUT: Implementar AppSidebar e Breadcrumbs",
        "9.3 MIGRAÇÃO: Transformar Tabs em Páginas Individuais",
        "9.4 ESTADO: Persistência de Contexto de Projeto"
      ],
      "tasks_detailed": [
        {
          "id": "9.1.1",
          "title": "Configuração de Rotas Filhas",
          "description": "Criar rotas '/project/:id/zonas', '/project/:id/locais', '/project/:id/cargas', '/project/:id/circuitos' no router principal."
        },
        {
          "id": "9.2.1",
          "title": "Componente AppSidebar",
          "description": "Criar sidebar colapsável usando Shadcn Sidebar, contendo menu de navegação do projeto atual e botão de voltar ao Dashboard."
        },
        {
          "id": "9.2.2",
          "title": "ProjectLayout Wrapper",
          "description": "Criar um Layout específico que busca o projeto pelo ID da URL e injeta no Contexto/Store, prevenindo 'prop drilling'."
        },
        {
          "id": "9.3.1",
          "title": "Refatorar Tabs para Pages",
          "description": "Converter 'ZoneTab.tsx' em 'pages/project/ZonesPage.tsx' (e similares), removendo a dependência do componente Tabs."
        }
      ],
      "deliverable": "Layout profissional com Sidebar, liberando espaço vertical e permitindo links diretos para seções do projeto.",
      "status": "pendente"
    },
    {
      "phase": "10",
      "name": "Motor de Dimensionamento (Cálculo NBR 5410)",
      "objective": "Implementar a inteligência matemática para dimensionar condutores e proteções",
      "branch_suggested": "feat/phase-10-calculation-engine",
      "features": [
        "10.1 BACKEND: Cálculos de Corrente (IB, IN, IZ)",
        "10.2 BACKEND: Tabelas de Capacidade de Corrente (Tabelas 36-39)",
        "10.3 BACKEND: Verificação de Queda de Tensão",
        "10.4 FRONTEND: Interface de Resultados"
      ],
      "tasks_detailed": [
        {
          "id": "10.1.1",
          "title": "Cálculo de IB (Corrente de Projeto)",
          "description": "Implementar função: IB = (Potencia / Tensão) / (FatorAgrupamento * FatorTemperatura)."
        },
        {
          "id": "10.2.1",
          "title": "Digitalização de Tabelas NBR",
          "description": "Criar repositório JSON/Python com as tabelas de capacidade de condução (Ref. NBR 5410 Tabela 36 a 39) baseadas no Método de Instalação."
        },
        {
          "id": "10.2.2",
          "title": "Algoritmo de Seleção de Condutor",
          "description": "Loop que itera sobre seções comerciais (1.5, 2.5, 4.0...) até encontrar IZ > IN > IB."
        },
        {
          "id": "10.3.1",
          "title": "Cálculo de Queda de Tensão (ΔV%)",
          "description": "Implementar fórmula: ΔV = (Resistividade * Comprimento * Corrente) / Seção. Alertar se > 4%."
        },
        {
          "id": "10.4.1",
          "title": "Endpoint de Dimensionamento",
          "description": "POST /api/v1/calculos/dimensionar/{circuito_id} -> Retorna JSON com seção, disjuntor e memória de cálculo."
        },
        {
          "id": "10.4.2",
          "title": "UI de Resultados",
          "description": "Criar modal ou painel lateral que exibe o resultado do cálculo e destaca erros (ex: 'Condutor muito fino para a distância')."
        }
      ],
      "output_schema": {
        "ResultadoDimensionamento": {
          "corrente_projeto_ib": "number",
          "corrente_corrigida_iz": "number",
          "disjuntor_sugerido_in": "number",
          "secao_condutor_mm2": "number",
          "queda_tensao_percentual": "number",
          "status": "'aprovado' | 'erro_queda_tensao' | 'erro_capacidade'",
          "memoria_calculo": [
            "Passo 1: IB = ...",
            "Passo 2: Fatores FCT=... FCA=...",
            "Passo 3: Tabela 36 coluna B1 selecionada..."
          ]
        }
      },
      "deliverable": "Sistema capaz de dimensionar circuitos automaticamente com justificativa normativa detalhada.",
      "status": "pendente"
    },
    {
      "phase": "10 advanced",
      "name": "Modulo de demanda",
      "objective": "Calculo independente por concessionaria",
      "initial_provider": "CEMIG (ND-5.1)",
      "deliverable": "Calculadora de demanda anexada ao projeto",
      "status": "pendente"
    },
    {
      "phase": "11",
      "name": "Persistencia Local e Portabilidade",
      "objective": "Gerenciar dados sem servidor",
      "features": [
        "Exportar JSON: Baixar projeto para backup/compartilhamento",
        "Importar JSON: Carregar projeto de colega/professor"
      ],
      "deliverable": "Sistema de Arquivos Virtual no Frontend",
      "status": "parcialmente_concluido"
    },
    {
      "phase": "12",
      "name": "Testes e Validacao",
      "objective": "Garantia de qualidade didatica",
      "tests": [
        "Unitarios: Formulas da NBR",
        "Integracao: Frontend -> Backend -> Frontend",
        "End-to-End: Fluxo completo de um projeto residencial"
      ],
      "deliverable": "Suite de testes verde",
      "status": "pendente"
    },
    {
      "phase": "13",
      "name": "Deploy e Documentacao",
      "objective": "Lancar versao publica",
      "deploy_strategy": {
        "Backend": "Render Free Tier (Stateless)",
        "Frontend": "Vercel (Global CDN)"
      },
      "docs": [
        "Manual do Usuario",
        "Nota Tecnica sobre as simplificacoes assumidas"
      ],
      "deliverable": "URL publica acessivel",
      "status": "pendente"
    }
  ]
}